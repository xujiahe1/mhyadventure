# 米哈游大冒险 (MiHoYo Adventure) - PRD

**版本**: 1.1
**状态**: 开发中 (In Progress)

---

## 目录

1.  [产品概述](#1-产品概述)
2.  [核心玩法循环](#2-核心玩法循环)
3.  [游戏世界观](#3-游戏世界观)
4.  [数值与经济体系](#4-数值与经济体系)
5.  [NPC 与社交系统](#5-npc-与社交系统)
6.  [交互逻辑管道](#6-交互逻辑管道)
7.  [界面与职场系统](#7-界面与职场系统)
8.  [附录：技术规范](#8-附录技术规范)

---

## 1. 产品概述

本项目是一款基于 LLM 的**职场模拟 RPG**。玩家在模拟的 IM (hoyowave) 界面中，通过自然语言交互与数值策略，体验从 P5 萌新到公司合伙人的职业生涯。

### 1.1 核心体验
*   **沉浸式职场**: 还原真实的互联网大厂工作流，从日报周报到跨部门撕逼。
*   **LLM 驱动**: NPC 并非脚本死板回复，而是基于性格与记忆的动态交互。
*   **多维成长**: 只有代码写得好不够，还需要高情商和政治资本。

### 1.2 技术架构
*   **Frontend**: React + TypeScript + TailwindCSS (仿飞书/Lark 界面)
*   **Backend**: FastAPI (Python) - 状态管理与数值计算
*   **AI Core**: Doubao (Ark) 模型 (内网 API) - 意图解析与双层生成

---

## 2. 核心玩法循环

### 2.1 玩家入职
游戏开始时，玩家需完成入职登记，该选择将决定游戏的**初始难度**与**数值倾向**。

*   **输入姓名**: 决定游戏内称呼。
*   **选择岗位**:
*   *   **产品**: 初始软技能较高、硬技能偏低。核心能力「画饼」（提升士气）。
*   *   **研发**: 初始硬技能较高、软技能偏低。核心能力「爆肝」（推进进度）。
*   *   **运营**: 属性较为均衡，初始金钱较高。核心能力「整活」（降低项目风险）。
*   **选择项目组 (Project)**: 决定初始环境压力（详见 [3.1 项目矩阵](#31-项目矩阵-project-matrix)）。

### 2.2 职级晋升体系

| 职级 | 称谓 | 核心权限 | 晋升条件 |
| :--- | :--- | :--- | :--- |
| **P5** | 萌新 | 执行、学习 | 存活12周，无重大事故 |
| **P6** | 资深 | 甩锅、摸鱼 | 参与 Live 项目，KPI ≥ A |
| **P7** | 专家/TL | PUA、招人 | 主导上线，政治资本 > 20 |
| **P8** | 制作人 | 画饼、立项 | 打造爆款 (Revenue > Target) |
| **P9** | 负责人 (VP) | 战略、背锅 | 推动新业务线，培养出 P8 |
| **P10** | 合伙人 (CXO) | 改变世界 | 决定公司生死，长期持有股份 |

### 2.3 结局体系
游戏无唯一终点，LLM 根据玩家生涯生成个性化结局。

*   **Bad Endings**: 保安护送 (Fired)、过劳倒下 (Health)、平庸之辈 (Mediocre)。
*   **Normal Endings**: 和平离职 (Resignation)、永远的打工人 (Stable)。
*   **Good Endings**: 财富自由 (Rich)、金牌制作人 (Producer)、高管之路 (Executive)。
*   **Hidden Endings**: 独立门户 (Indie)、穿越异世界 (Isekai)。

---

## 3. 游戏世界观

### 3.1 项目矩阵
项目组决定了玩家的日常压力与收益风险。

| 项目名称 | 状态 | 难度 (1-5) | 风险 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **IAM (Infra)** | Live | 4 | 15 | 基础设施，稳健但枯燥 |
| **崩坏3** | Live | 2 | 10 | 养老项目，收益稳定 |
| **原神** | Live | 5 | 25 | 核心营收，高压高回报 |
| **星穹铁道** | R&D | 3 | 15 | 上升期项目 |
| **绝区零** | R&D | 4 | 20 | 潮流新贵 |
| **HYG** | R&D | 3 | **30** | 高风险预研项目，可能被砍 |

### 3.2 动态演化
*   **新项目生成**: 每 **2年** (游戏时间) 触发一次 "新预研项目" 事件。
    *   随机生成类型 (Game/App/Infra) 与数值 (难度/风险/预算)。
    *   玩家可申请 **转岗 (Transfer)** 成为开荒成员。
*   **季度局外事件**: 每 **3个月** 触发全服事件 (如 "元宇宙爆发", "版号收紧")，动态修正全局数值 (KPI倍率, 预算等)。

### 3.3 全局事件系统
*   **预设事件池**: 30+ 条全局事件，覆盖健康、公司、项目、生活、运势、职业、元事件等类型。
*   **触发条件**:
    * 基于周数 (`min_week`/`max_week`)、玩家心情/精力区间、当前项目风险等过滤候选事件。
    * 每个自然日按基础概率判定事件，基础概率约 8%，当心情或精力过低、项目风险过高时概率提高。
*   **表现形式**:
    * 事件触发时，`active_global_event` 写入 GameState，前端弹出全屏模态遮罩。
    * 遮罩期间输入框禁用，玩家必须阅读提示并点击「知道了，继续上班」确认后才能继续操作。
*   **关键事件示例**:
    * 健康线：住院观察（直接跳过一个季度）、职业倦怠强制休整（跳过 4 周，恢复精力但损失收入）。
    * 项目线：安全事件应急、离谱联动突袭、Bug 雨来袭等，直接影响项目风险、进度与 Bug 数量。
    * 元事件与梗事件：通宵画 AI 战略大饼、All in 二次元赛道、被迫出道的游戏主播等，用较夸张的方式塑造职场黑色幽默。
*   **数值影响**:
    * 事件统一通过后端函数 `_activate_global_event` 结算，对 `week/money/mood/energy/political_capital` 等关键数值做批量调整。
    * 部分事件会记录为长期事实 (Fact)，影响后续结局生成与职业轨迹。

---

## 4. 数值与经济体系

系统遵循 **三层转化模型**，严禁直接修改结果数值。

### 4.1 数值分层
1.  **元属性**: 先天资质 (作为计算系数)。
    *   悟性、精力上限等。
2.  **能力与状态**: 随时间积累/消耗。
    *   硬技能、软技能、信任度、心情、精力等。
3.  **产出**: 结果数值，用于晋升与消费。
    *   业绩、政治资本、金钱等。

### 4.2 核心公式 (Simulation Logic)
以 "工作 (Work)" 行为为例：
*   **消耗**: `Energy - 10`
*   **产出**: `KPI Gain = floor(10 * (HardSkill / 50) * LearningRate * MoodModifier)`
    *   *MoodModifier*: 心情越好，效率越高 (Mood 80 ≈ 0.8)。
*   **限制**: `Energy < 10` 无法进行高强度工作。

### 4.3 交互影响 (Interaction Effects)
*   **Player -> Project**:
*   *   投入「硬技能」 -> 增加项目进度。
*   *   投入「软技能」 -> 提升团队士气，降低项目风险。
*   **Project -> Player**:
    *   项目成功 -> `Bonus` (奖金) + `Promotion` (晋升)。
    *   项目被砍 -> `Trust` 大跌，面临裁员风险。
### 4.4 设备与工位升级 (Equipment & Gear)
*   **显卡**:
*   * 通过米购指令 `cmd:buy_gpu` 购买，每级消耗 ¥3000。
*   * 购买立即提升硬技能，并记录 `gear_gpu_level`，间接提高工作类行为的 KPI 产出。
*   **显示器**:
    * 通过 `cmd:buy_monitor` 升级，每级消耗 ¥2000。
    * 提升 `Mood`，缓解长期加班与项目压力带来的负面情绪。
*   **工学椅**:
    * 通过 `cmd:buy_chair` 升级，每级消耗 ¥1500。
    * 永久提升 `MaxEnergy`，并即时回复部分 `Energy`，增强持续作战能力。

### 4.5 培训与成长 (Training)
*   **基础进阶课 (`cmd:learn_skill`)**:
*   * 消耗 ¥100 与 30 点精力，根据岗位定向提升软/硬技能。
    * 适合作为日常稳定成长手段。
*   **硬核技术训练营 (`cmd:train_hard`)**:
*   * 消耗 ¥200 与 40 点精力，显著提升硬技能。
*   **沟通协作工作坊 (`cmd:train_soft`)**:
*   * 消耗 ¥200 与 30 点精力，集中培养软技能。
*   **项目管理与领导力 (`cmd:train_leadership`)**:
*   * 消耗 ¥300 与 35 点精力，提升软技能与政治资本。

### 4.6 金钱循环
*   **收入来源**:
    * 项目里程碑与上线奖金、全局 Lucky 事件（理财小阳春、项目特别激励等）。
*   **支出场景**:
    * 日常消耗（米饭点餐）、设备升级（显卡/显示器/工学椅）、培训课程、健康相关全局事件（住院、倦怠休整等）。
*   **设计目标**:
    * 金钱围绕「体力维持 → 能力提升 → 项目收益 → 再投资」形成闭环经营养成系统。

---

## 5. NPC 与社交系统

### 5.1 NPC 分类
*   **预定义 NPC**: 由策划维护的核心人物，存放于配置表（如 `backend/backend/data/npcs.json`），不少于 100 位，有固定人设与基础数值。
*   **随机 NPC**: 通过脚本批量生成的路人同事，用于填充各项目组的日常氛围。

每个 NPC 至少包含以下字段：

*   **项目组**：如 IAM、崩坏3、原神、星穹铁道、绝区零、HR、General 等。
*   **职级**：P4–P10，用于判断管理链与是否可被玩家管理。
*   **性格/人设**：若干中文标签或短句，作为大模型生成台词与事件时的提示。
*   **状态**：在职 / 已离职 等，用于生态系统判断。
*   **管理链字段**：  
    * `manager_id`：指向该 NPC 的直属上级 NPC（如 IAM 项目负责人）。  
    * `relations`：记录与其他 NPC 的关系标签（对立、合作、上级、下属等），用于驱动项目生态事件。

### 5.2 核心人物图鉴
| 姓名 | 角色/职位 | 性格标签 | 备注 |
| :--- | :--- | :--- | :--- |
| **Cai (蔡总)** | CTO | 技术宅神、严厉 | 关注底层技术 |
| **Dawei (大伟哥)** | 总裁 | 亲民、用户视角 | 关注玩家体验 |
| **Luo (罗总)** | 联合创始人 | 低调、务实 | 关注商业化/安全 |
| **Shao (烧鸡)** | 编剧 | 文青、刀子手 | 崩坏系列主笔 |
| **Chep** | 美术总监 | 强迫症、唯美 | 画面细节控 |
| **Z** | 音乐总监 | 随性、灵感 | HOYO-MiX 主理人 |
| **CiCi** | HRBP Head | 知性、关怀 | 员工心理健康 |
| **Aquila** | Infra Head | 稳重、可靠 | 服务器守护者 |
| **Fish** | 市场 Head | 活跃、整活 | 社区舆论操盘 |
| **AI-Chan** | 系统/看板娘 | 打破第四面墙 | 新手引导 |

除以上内置核心 NPC 外，预设配置表中还会提供部分米哈游相关 IP 形象（如派蒙、琪亚娜等）在公司世界观中的「拟人化同事版本」，用于增强气氛与彩蛋感。

### 5.3 上下文与记忆 (Context & Memory)
*   **上下文隔离 (Isolation)**:
    *   **私聊 (DM)**: 独立 Context，不与群聊混淆。
    *   **群聊 (Group)**: 支持 `@NPC` 触发特定回复。
*   **记忆持久化**:
    *   **Short-term**: 最近 N 轮对话 (Token Window)。
    *   **Long-term**: 关键事实 (Fact) 与摘要 (Summary) 存入 Vector DB。

---

## 6. 交互逻辑管道

### 6.1 模糊意图量化 (Intent Quantization)
系统将自然语言映射为数值操作。

*   **"稍微加个班"**: `Light Overtime` -> Energy -15, KPI * 1.1.
*   **"通宵肝出来"**: 通宵加班 -> Energy -50, KPI * 1.5，健康风险上升。
*   **"我不干了"**: `Refuse` -> Energy +10, Trust -10.

### 6.2 处理流程 (Pipeline Steps)
1.  **Input**: 用户输入文本。
2.  **Analyzer (LLM Layer 1)**: 分析意图，输出 JSON (Intent, Difficulty)。
3.  **Calculator (Backend)**: 执行数值计算 (Python)，更新 State。
4.  **Generator (LLM Layer 2)**: 生成 NPC 回复与系统旁白。  
    * 输入中会显式包含目标 NPC 的项目组、职级、性格等信息，使同一条玩家发言在面对不同 NPC 时产生差异化回复（例如项目负责人偏向排期和风险，HR 偏向氛围和健康）。

### 6.3 职级与下属玩法

*   **玩家职级**：  
    * 初始为 P5，根据 KPI、政治资本、项目营收等指标在每周结算时判断是否晋升。  
    * 规则示例：P6 需要一定周数 + KPI ≥ 500；P7 需要更高 KPI 与政治资本；更高职级还需全局营收达到阈值。
*   **P7 管理权限解锁**：  
    * 当玩家达到 P7 及以上，可通过指令管理下属：  
        * `cmd:add_subordinate:NPC_ID` — 将同项目组、低职级且在职的 NPC 加入自己的下属列表。  
        * `cmd:remove_subordinate:NPC_ID` — 解除与该 NPC 的一对一汇报关系。  
    * 下属信息会记录在游戏状态中（如 `player_subordinates` 与 NPC 的 `manager_id` 字段）。
*   **指派下属工作**：  
    * 单个指派：`cmd:sub_work:NPC_ID`，由指定下属帮忙推进当前项目进度。  
        * 效果：项目进度小幅提升；下属心情下降，过低时会导致信任度下降。  
    * 集体指派：`cmd:sub_all_work`，发动所有在职下属集体推进项目。  
        * 效果：项目进度显著提升；若有下属心情跌破阈值，会在旁白中提示「对高强度压榨颇有怨言」，并下调其信任度。
*   **设计目标**：  
    * 形成「晋升 → 获得管理权 → 通过下属放大产出 → 但需承担人心与士气代价」的轻量管理玩法。

### 6.3.1 项目负责人与玩家直属上级

*   **项目负责人**：  
    * 每个项目组至少有一名负责人 NPC（通常为 P7+ 或在配置中标注「负责人」），负责在玩法与叙事上代表该项目组。  
    * 项目负责人可以是更高层级（如 P9/P10）的 owner，并不等同于所有员工的直属上级，更偏向业务线总负责人角色。
*   **玩家直属上级**：  
    * 在 `init_game` 时，系统会优先在玩家所属项目组中查找比玩家高 1–2 级的中层 NPC（如 P6/P7）作为直属上级，并记录在玩家状态中（如 `leader_id` 字段）。  
    * 若同项目组中不存在合适的中层 NPC，则退回使用项目负责人作为临时直属上级。  
    * 玩家在入职时收到的首条项目相关欢迎/分工信息，由该直属上级在群聊中发起（可由 LLM 根据其性格与项目情况生成更自然的欢迎与任务分配文案）。  
*   **设计目标**：  
    * 保证每个项目都有一个明确的「说话人」，让玩家在入职瞬间就能感知到具体上级的风格与项目氛围，同时为后续管理链、考核与生态事件提供基础。

### 6.3.2 晋升评估周期与条件（对齐当前实现）

*   **评估节奏**：  
    * 从第 12 周开始，在每周结算时调用晋升检查逻辑。  
    * 满足晋升条件时立即晋升并输出「[晋升] 恭喜！你晋升为 Px」旁白，无须等待季度末。  
    * 若未满足下一档职级条件，则仅在「评估周」（约每 12 周一次）输出「[晋升评估] 本周期暂未晋升」提示与改进建议。
*   **核心指标来源**：  
    * KPI：主要由「工作 (WORK)」类行为产出，受硬技能、悟性倍率与心情影响（参见 4.2、4.3）。  
    * 政治资本 (Political Capital)：通过与高层 NPC 建立信任、管理下属、关键项目表现及部分课程/事件获得。  
    * 项目营收总和 (Revenue Total)：所有项目营收之和，由项目里程碑结算与 Live 周度营收累积（参见 3.3、4.3）。  
    * 重大事故数 (Major Accidents)：当当前项目风险高企（如 Risk ≥ 90）时增加，用于惩罚长期高风险运营。  
    * 参与 Live 项目数 (Participated Live Projects)：玩家在至少一个 Live 项目上持续输出时自动记录，用于避免只在预研项目「纸面优秀」。
*   **当前职级门槛（硬规则）**：  
    * P5 → P6（试用期通过）：  
        * 第 12 周及以后；  
        * 累计 KPI ≥ 500；  
        * 至少参与 1 个已上线项目；  
        * 期间无重大事故记录。  
    * P6 → P7（成为项目骨干）：  
        * 第 24 周及以后；  
        * 累计 KPI ≥ 1500；  
        * 政治资本 ≥ 10。  
    * P7 → P8（领域小负责人）：  
        * 第 36 周及以后；  
        * 累计 KPI ≥ 3000；  
        * 政治资本 ≥ 25；  
        * 项目总营收 ≥ 20,000；  
        * 重大事故次数不超过 1 次。  
    * P8 → P9（部门关键角色）：  
        * 第 52 周及以后；  
        * 累计 KPI ≥ 5000；  
        * 政治资本 ≥ 40；  
        * 项目总营收 ≥ 50,000。  
    * P9 → P10（顶级专家/管理）：  
        * 第 80 周及以后；  
        * 政治资本 ≥ 80；  
        * 项目总营收 ≥ 200,000。  
*   **评估失败反馈**：  
    * 在评估周若未晋升，系统会根据玩家当前职级与数值缺口生成结构化建议，例如：  
        * P5 阶段：提示「至少参与一个已上线项目」「避免重大事故」「累计更多有效 KPI」。  
        * P6 阶段：提示「提升项目 KPI 贡献」「多与关键老板正向互动积累政治资本」。  
        * P7+ 阶段：提示「推动至少一个项目形成可观营收」「在跨团队协作中建立话语权」「降低重大事故次数」等。  
    * 建议以「[晋升评估] 本周期暂未晋升。下一档目标：Px。建议：……」的系统旁白形式出现在群聊中，用于引导玩家理解数值目标与下一步行动。

### 6.4 NPC 生态逻辑

*   **触发时机**：  
    * 以「周」为单位进行结算时，除项目风险等检查外，同时对玩家「已知 NPC」和玩家下属 NPC 执行生态检查。  
    * 仅对玩家有感知的 NPC 进行生态演化，避免对完全路人 NPC 进行无意义的大模型调用。
*   **影响因子**：  
    * Heart 数值：NPC 的心情与信任度越低，越容易触发负向变动。  
    * 项目组：高压项目线的 NPC 更容易申请转岗或离职。  
    * 职级：高职级 NPC 更倾向晋升或跨项目调配。
*   **可能事件**：  
    * **离职**：NPC 状态变为「已离职」，若为玩家下属则自动从下属列表移除，同时小幅降低玩家心情。  
    * **转岗**：NPC 项目从当前项目迁移到其他项目；若与玩家不再同项目且是下属，则解除下属关系。  
    * **晋升**：NPC 职级提升（如从 P5 到 P6），同时略微提升其信任度。  
*   **表现形式**：  
    * 系统在群聊中以旁白形式输出类似「[人事变动] XXX 申请内部转岗，调往 YYY 项目组」的文案。  
    * 未来可将事件生成文本交由大模型根据 NPC 性格、项目压力等自动润色。
*   **预设生态关系**：  
*   * NPC 模型中支持 `relations` 字段，用于记录与其他 NPC 的关系标签（如「对立」「合作」「上级」「下属」等）。  
*   * 典型案例：IAM 项目组中，P7 研发程屿与 P6 产品唐蔷互相标记为「对立」，在周度结算时更容易触发针锋相对的项目生态事件。  
*   **关系驱动事件**：  
    * 周度生态结算时，若玩家已知 NPC 与其关系人同属某项目且均在职，则以一定概率触发「项目生态」旁白：  
        * 「对立」关系更容易生成吵架、争论类事件，双方心情下降，若发生在玩家当前项目组，还会轻微拖累玩家心情。  
        * 「合作」或「搭档」关系更容易生成互相补位、配合默契类事件，提升双方心情，并在同项目情况下轻微提升玩家心情。  
*   **动态生态生成**：  
*   * 对无预设 `relations` 的扩展 NPC，按项目组进行分组，在每一局新游戏初始化时随机生成若干「合作」或「对立」关系对。  
*   * 关系生成会综合职级、岗位与性格标签：例如同项目且性格偏强硬的研发/产品组合，更倾向被标记为「对立」，高职级 NPC 更容易与同项目下级形成上下级或评价型关系。  
    * 这些关系仅存在于当前存档内，不会写回静态配置表，使每一局游戏中的 NPC 生态略有差异。

### 6.5 群聊内 NPC 之间的交互

*   **基础逻辑**：  
    * 当玩家在群聊中发言时，首先按原有流程选择 1–3 名 NPC 对玩家进行回复（基于项目组、性格等）。  
    * 在此基础上，以一定概率额外触发「NPC 互相插嘴」的对话片段，形成吵架、附和等多方互动效果。
*   **触发规则示例**：  
    * 优先选择与玩家当前项目相关或全局项目（General）的 NPC 作为互相插嘴对象。  
    * 高职级 NPC 更可能发起点评，下级 NPC 更可能在后面附和或补充。  
*   **表现形式**：  
    * 追加 1–2 条 NPC 发言，例如「项目负责人吐槽需求风险」「执行同学强调排期现实情况」等，使整个群聊更接近真实职场群氛围。

### 6.6 动态快捷回复 (LLM Suggested Replies)
*   **生成逻辑**:
    * 每次完成一次聊天或指令结算后，后端根据最近约 8 条 `chat_history` 调用 LLM 生成 2 条候选回复，存入 `state.suggested_replies`。
    * 生成规则：强依赖最近一轮玩家发言与 NPC 反馈，长度控制在 10 个汉字以内。
*   **前端表现**:
    * 在输入框上方渲染一排可点击 Chip，优先展示动态 LLM 建议，其次为固定预设快捷语（如「爆肝干活」「摸鱼一会」等）。
    * 玩家点击后会将建议文案写入输入框，可二次修改后通过 Enter 发送。
*   **设计目的**:
    * 强化「上下文相关选项」体验，例如日报被吐槽时给出「进一步优化日报」等自然后续句子。
    * 降低长对话中的输入成本，保持行为仍然由玩家最终确认。

### 6.7 基于玩家输入内容触发相关 NPC

*   **关键词解析**：  
    * 系统会对玩家在群聊中的自然语言进行简单关键词解析，例如「邀请制」「可见性」「IAM」等。  
    * 当检测到这些关键词时，会在 NPC 配置中查找在职且与关键词高度相关的 NPC（例如 trait 中包含「负责 IAM 邀请制和可见性项目」的角色）。  
*   **触发规则**：  
    * 若未明确 @ 某个 NPC，但根据玩家输入匹配到了相关 NPC，则该 NPC 会被视为当前对话的目标对象：  
        * 在本局存档中被标记为「已认识」的 NPC。  
        * 在后续 LLM 回复阶段优先作为发言人参与对话。  
    * 匹配不到合适 NPC 时，不做额外触发，保持原有逻辑。  
*   **设计目的**：  
    * 让「玩家提到某个主题 → 负责这个领域的 NPC 出现并回应」形成自然的因果关系，例如玩家频繁讨论 IAM 邀请制时，对应负责该项目的 NPC 会主动加入群聊或发表看法。  

### 6.8 文本情绪影响 NPC 数值

*   **情绪解析**：  
    * 系统会对玩家输入的自然语言做简单情绪分析，将其粗分为「正面」「负面」「中性」三类。  
    * 情绪分析基于预设的中文情绪关键词列表，例如「好」「棒」「优秀」「厉害」「赞」「满意」「支持」「认可」等视为正向词；「差」「烂」「垃圾」「糟糕」「不满意」「反对」「吐槽」「批评」等视为负向词。  
    * 在一次发言中，统计正向与负向关键词出现次数，用于估算情绪方向与强度。  
*   **数值调整规则**：  
    * 当该轮对话中存在明确的目标 NPC（例如玩家正在与某个 NPC 私聊，或根据 [6.7](#67-基于玩家输入内容触发相关-npc) 解析出了与当前话题最相关的 NPC）且情绪不为中性时，会对该 NPC 的信任度与心情进行数值调整。  
    * 情绪强度会被压缩到固定区间，并映射为 1–5 点的整数变化值：  
        * 正面情绪：`Trust +Δ`，`Mood +Δ`。  
        * 负面情绪：`Trust -Δ`，`Mood -Δ`。  
        * 中性情绪：不做调整。  
    * 调整后会对数值做 0–100 的边界钳制，防止出现负数或超过上限。  
*   **表现形式**：  
    * 数值变化会以系统旁白的形式提示，例如「程屿 因你的正面评价，信任度和心情提升了 3」或「唐蔷 因你的负面评价，信任度和心情下降了 2」。  
    * 该旁白作为事实 (Fact) 写入游戏状态，为后续结算与结局生成提供依据。  
*   **设计目的**：  
    * 让玩家的具体措辞真正影响职场关系，而不仅是触发指令结果：当玩家在群里夸赞某位同事的付出时，对方会对玩家更加信任、心情更好；反之若经常在群内公开吐槽或批评某人，则更容易导致对方对玩家产生负面观感，在后续评审、合作与生态事件中体现出来。  

---

## 7. 界面与职场系统

界面严格参考 **Lark/飞书** 桌面端设计，强调效率与沉浸感。

### 7.1 布局结构
*   **App Bar (最左侧)**: 核心入口。
    *   消息 (Messages)
    *   工作台 (Workbench)
*   **Nav Bar (次左侧)**: 群聊/私聊选择。
*   **Content Area (中间)**: 聊天窗口 / 应用主界面。
*   **Info Panel (右上角)**: 个人中心，悬停后展示3层数值。
### 7.2 应用工作台 (App Workbench)
集成在左侧 App Bar，作为「经营养成」入口，围绕金钱与能力成长设计 3 大模块。

1.  **米饭** — 日常维持  
    * 入口：工作台卡片 + 「点外卖」按钮，可选择不同档位的干饭方式：  
        * `cmd:eat_mifan_light`：速食简餐，消耗 ¥15，精力 +10，心情 +2。  
        * `cmd:eat_mifan`：普通套餐，消耗 ¥30，精力 +20，心情 +5。  
        * `cmd:eat_mifan_luxury`：豪华套餐，消耗 ¥80，精力 +30，心情 +15。  
    * 设计目标：让「时间不够只能快速吃点」「发工资犒劳自己一顿」这类真实场景在数值上有所体现。
2.  **米购** — 固定资产与礼物  
    * 礼物：`cmd:buy_gift`，消耗 ¥200，为随机或当前对话 NPC 提升信任度，若对象为高层可额外增加政治资本。  
    * 固定资产升级：  
        * 显卡 (`cmd:buy_gpu`)：提升硬技能与 GPU 等级。  
        * 显示器 (`cmd:buy_monitor`)：提升 Mood 与显示器等级。  
        * 工学椅 (`cmd:buy_chair`)：提升 MaxEnergy 与当前 Energy，并提升椅子等级。
3.  **米忽悠学院** — 课程与培养  
    * 基础进阶课 (`cmd:learn_skill`)：低成本、根据岗位定向提升当前主修能力。  
    * 硬核技术训练营 (`cmd:train_hard`)：强化硬技能。  
    * 沟通协作工作坊 (`cmd:train_soft`)：强化软技能。  
    * 项目管理与领导力 (`cmd:train_leadership`)：同时提升软技能与政治资本，为晋升做准备。

### 7.3 输入区与事件表现 (Input & Events)
*   **输入控件**:
    * 使用多行文本框，支持 Shift+Enter 换行，单独 Enter 发送消息。
    * 当 `game_over` 或存在 `active_global_event` 时输入框禁用，提示文案引导玩家阅读结局或全局事件。
*   **快捷回复区域**:
    * 位于输入框上方的 Chip 区，优先展示 LLM 动态建议，再补充固定预设语。
*   **全屏事件遮罩**:
    * 触发全局事件时，界面中央弹出事件标题与说明的模态框，禁止后续输入。
    * 玩家通过点击「知道了，继续上班」按钮向后端发送确认请求，清空 `active_global_event`，恢复正常聊天与操作。

---

## 8. 附录：技术规范 (Appendix)

### 8.1 LLM 接入
使用内网 OpenAI 兼容接口，调用字节 Ark Doubao 模型。

```python
from openai import AsyncOpenAI
import os

API_BASE = "https://ark.cn-beijing.volces.com/api/v3"
API_KEY = os.getenv("ARK_API_KEY")

client = AsyncOpenAI(base_url=API_BASE, api_key=API_KEY)

async def call_llm(messages):
    resp = await client.chat.completions.create(
        model="doubao-seed-1-8-251228",
        messages=messages,
        temperature=0.7,
        max_tokens=512,
    )
    return resp.choices[0].message.content
```
